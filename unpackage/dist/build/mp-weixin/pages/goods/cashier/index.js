require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/cashier/index"],{"1dee":function(t,e,i){"use strict";(function(t,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i("350e"),r=i("b47e"),o={components:{countDown:function(){i.e("components/countDown/index").then(function(){return resolve(i("3dc7"))}.bind(null,i)).catch(i.oe)},numberScroll:function(){i.e("components/numberScroll").then(function(){return resolve(i("3bc8"))}.bind(null,i)).catch(i.oe)}},data:function(){return{checked:!1,datatime:1676344056,cartArr:[{name:this.$t("微信支付"),icon:"icon-weixin2",value:"weixin",title:this.$t("使用微信快捷支付"),payStatus:1},{name:this.$t("支付宝支付"),icon:"icon-zhifubao",value:"alipay",title:this.$t("使用支付宝支付"),payStatus:1},{name:this.$t("余额支付"),icon:"icon-yuezhifu",value:"yue",title:this.$t("可用余额"),payStatus:1},{name:this.$t("线下支付"),icon:"icon-yuezhifu1",value:"offline",title:this.$t("使用线下付款"),payStatus:2},{name:this.$t("好友代付"),icon:"icon-haoyoudaizhifu",value:"friend",title:this.$t("找微信好友支付"),payStatus:1}],orderId:0,fromType:"",active:0,payPrice:0,payPriceShow:0,payPostage:0,offlinePostage:!1,invalidTime:0,initIn:!1,jumpData:{orderId:"",msg:""},formContent:""}},watch:{cartArr:{handler:function(t,e){var i=this,a=[];t.forEach((function(t,e){t.payStatus&&(t.index=e,a.push(t))})),this.$nextTick((function(t){i.active=a[0].index,i.paytype=a[0].value}))},immediate:!0,deep:!0}},onLoad:function(t){t.order_id&&(this.orderId=t.order_id),t.from_type&&(this.fromType=t.from_type),this.getBasicConfig()},onShow:function(){var e=t.getEnterOptionsSync();if("1038"==e.scene&&"wxef277996acc166c3"==e.referrerInfo.appId&&this.initIn){var i=e.referrerInfo.extraData;this.initIn=!1,i?"success"==i.code?this.$util.Tips({title:this.$t("支付成功"),icon:"success"},{tab:5,url:"/pages/goods/order_pay_status/index?order_id=".concat(this.orderId,"&msg=").concat(this.jumpData.msg,"&type=3&totalPrice=").concat(this.payPriceShow)}):"cancel"==i.code?this.$util.Tips({title:this.$t("取消支付")},{tab:5,url:"/pages/goods/order_pay_status/index?order_id=".concat(this.orderId,"&msg=").concat(this.$t("取消支付"),"&type=3&totalPrice=").concat(this.payPriceShow,"&status=2")}):a.reLaunch({url:"/pages/goods/order_pay_status/index?order_id=".concat(this.orderId,"&msg=").concat(this.$t("支付失败"),"&totalPrice=").concat(this.payPriceShow)}):this.$util.Tips({title:this.$t("取消支付")},{tab:5,url:"/pages/goods/order_pay_status/index?order_id=".concat(this.orderId,"&msg=").concat(this.$t("取消支付"),"&type=3&totalPrice=").concat(this.payPriceShow,"&status=2")})}},methods:{getBasicConfig:function(){var t=this;(0,r.basicConfig)().then((function(e){t.cartArr[0].payStatus=e.data.pay_weixin_open||0,t.cartArr[1].payStatus=e.data.ali_pay_status||0,t.cartArr[1].payStatus=0,t.cartArr[2].payStatus=e.data.yue_pay_status,e.data.offline_pay_status?t.cartArr[3].payStatus=1:t.cartArr[3].payStatus=0,t.cartArr[4].payStatus=e.data.friend_pay_status||0,t.getCashierOrder()})).catch((function(e){return a.hideLoading(),t.$util.Tips({title:e})}))},getCashierOrder:function(){var t=this;a.showLoading({title:this.$t("创建订单中")}),(0,n.getCashierOrder)(this.orderId,this.fromType).then((function(e){t.payPrice=t.payPriceShow=e.data.pay_price,t.payPostage=e.data.pay_postage,t.offlinePostage=e.data.offline_postage,t.invalidTime=e.data.invalid_time,t.cartArr[2].number=e.data.now_money,t.number=Number(e.data.now_money)||0,a.hideLoading()})).catch((function(e){return a.hideLoading(),t.$util.Tips({title:e})}))},payType:function(t,e,i){this.active=i,this.paytype=e,this.number=t,this.offlinePostage&&(this.payPriceShow="offline"==e?this.$util.$h.Sub(this.payPrice,this.payPostage):this.payPrice)},formpost:function(t,e){var i=document.createElement("form");for(var a in i.action=t,i.method="post",i.target="_self",i.style.display="none",e){var n=document.createElement("input");n.name=a,n.value=e[a],i.appendChild(n)}document.body.appendChild(i),this.$nextTick((function(t){i.submit()}))},waitPay:function(){a.reLaunch({url:"/pages/goods/order_pay_status/index?order_id="+this.orderId+"&msg=取消支付&type=3&status=2&totalPrice="+this.payPriceShow})},goPay:function(e,i){var r=this,o=this;return o.orderId?"yue"==i&&parseFloat(e)<parseFloat(o.payPriceShow)?o.$util.Tips({title:o.$t("余额不足")}):(a.showLoading({title:o.$t("支付中")}),"friend"==i&&o.orderId?(a.hideLoading(),a.navigateTo({url:"/pages/users/payment_on_behalf/index?order_id="+o.orderId+"&spread="+this.$store.state.app.uid,success:function(t){},fail:function(){},complete:function(){}})):void(0,n.orderPay)({uni:o.orderId,paytype:i,type:o.friendPay?1:0}).then((function(e){var n=e.data.status,s=e.data.result.order_id,c=e.data.result.jsConfig,u="/pages/goods/order_pay_status/index?order_id="+r.orderId+"&msg="+e.msg+"&type=3&totalPrice="+r.payPriceShow,d="/pages/users/payment_on_behalf/index?order_id="+r.orderId+"&spread="+r.$store.state.app.uid;switch(n){case"ORDER_EXIST":case"EXTEND_ORDER":return a.hideLoading(),o.$util.Tips({title:e.msg},{tab:5,url:u});case"ALLINPAY_PAY":a.hideLoading(),r.initIn=!0,t.openEmbeddedMiniProgram({appId:"wxef277996acc166c3",extraData:{cusid:c.cusid,appid:c.appid,version:c.version,trxamt:c.trxamt,reqsn:c.reqsn,notify_url:c.notify_url,body:c.body,remark:c.remark,validtime:c.validtime,randomstr:c.randomstr,paytype:c.paytype,sign:c.sign,signtype:c.signtype}}),r.jumpData={orderId:e.data.result.order_id,msg:e.msg};break;case"PAY_ERROR":return a.hideLoading(),o.$util.Tips({title:e.msg},{tab:5,url:u});case"SUCCESS":return a.hideLoading(),"friend"!==i?o.$util.Tips({title:e.msg,icon:"success"},{tab:4,url:u}):o.$util.Tips({title:e.msg,icon:"success"},{tab:4,url:d});case"WECHAT_PAY":o.toPay=!0;var l="";l=a.requestOrderPayment?"requestOrderPayment":"requestPayment",a[l]({timeStamp:c.timestamp,nonceStr:c.nonceStr,package:c.package,signType:c.signType,paySign:c.paySign,success:function(t){return a.hideLoading(),o.BargainId||o.combinationId||o.pinkId||o.seckillId||o.discountId?o.$util.Tips({title:o.$t("支付成功"),icon:"success"},{tab:4,url:u}):o.$util.Tips({title:o.$t("支付成功"),icon:"success"},{tab:5,url:u})},fail:function(t){return a.hideLoading(),o.$util.Tips({title:o.$t("取消支付")},{tab:5,url:u+"&status=2"})},complete:function(t){if(a.hideLoading(),"requestPayment:cancel"==e.errMsg||"requestOrderPayment:cancel"==t.errMsg)return o.$util.Tips({title:o.$t("取消支付")},{tab:5,url:u+"&status=2"})}});break;case"PAY_DEFICIENCY":return a.hideLoading(),o.$util.Tips({title:e.msg},{tab:5,url:u+"&status=1"});case"WECHAT_H5_PAY":a.hideLoading(),o.$util.Tips({title:o.$t("等待支付中")},{tab:4,url:u+"&status=0"}),setTimeout((function(){location.href=e.data.result.jsConfig.h5_url}),1500);break;case"ALIPAY_PAY":a.navigateTo({url:"/pages/users/alipay_invoke/index?id=".concat(s,"&link=").concat(c.qrCode)});break}})).catch((function(t){return a.hideLoading(),o.$util.Tips({title:t},(function(){o.$emit("onChangeFun",{action:"pay_fail"})}))}))):o.$util.Tips({title:o.$t("请选择要支付的订单")})}}};e.default=o}).call(this,i("bc2e")["default"],i("543d")["default"])},"34f5":function(t,e,i){"use strict";var a=i("7fbf"),n=i.n(a);n.a},"65c3":function(t,e,i){"use strict";(function(t,e){var a=i("4ea4");i("363e");a(i("66fd"));var n=a(i("c7b3"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(n.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},7801:function(t,e,i){"use strict";i.r(e);var a=i("1dee"),n=i.n(a);for(var r in a)["default"].indexOf(r)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(r);e["default"]=n.a},"7fbf":function(t,e,i){},c7b3:function(t,e,i){"use strict";i.r(e);var a=i("ece7"),n=i("7801");for(var r in n)["default"].indexOf(r)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(r);i("34f5");var o=i("f0c5"),s=Object(o["a"])(n["default"],a["b"],a["c"],!1,null,"e263641c",null,!1,a["a"],void 0);e["default"]=s.exports},ece7:function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){}));var a=function(){var t=this,e=t.$createElement,i=(t._self._c,t.payPriceShow?t.$t("￥"):null),a=t.payPriceShow?t.$t("支付剩余时间"):null,n=t.payPriceShow?t.$t("支付方式"):null,r=t.payPriceShow?t.__map(t.cartArr,(function(e,i){var a=t.__get_orig(e),n=t.$t(e.name),r="yue"==e.value?t.$t(e.title):null,o="yue"==e.value?t.$t("￥"):null,s="yue"!=e.value?t.$t(e.title):null;return{$orig:a,m3:n,m4:r,m5:o,m6:s}})):null,o=t.payPriceShow?t.$t("确认支付"):null,s=t.payPriceShow?t.$t("暂不支付"):null;t.$mp.data=Object.assign({},{$root:{m0:i,m1:a,m2:n,l0:r,m7:o,m8:s}})},n=[]}},[["65c3","common/runtime","common/vendor"]]]);